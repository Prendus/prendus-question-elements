<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../redux-store-element/redux-store.html">
<link rel="import" href="prendus-view-question.html">
<link rel="import" href="text-editor-tools/prendus-variable-tool.html">
<link rel="import" href="text-editor-tools/prendus-input-tool.html">
<link rel="import" href="text-editor-tools/prendus-essay-tool.html">
<link rel="import" href="text-editor-tools/prendus-radio-tool.html">
<link rel="import" href="text-editor-tools/prendus-check-tool.html">
<link rel="import" href="text-editor-tools/prendus-math-tool.html">
<link rel="import" href="text-editor-tools/prendus-image-tool.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/wysiwyg-e/wysiwyg-e.html">
<link rel="import" href="../../bower_components/juicy-ace-editor/juicy-ace-editor.html">

<dom-module id="prendus-edit-question">
    <template>
        <style>
            .editor {
                width: 100%;
                height: 50vh;
                box-shadow: 0px 0px 3px grey;
                margin: 0 auto;
            }

            .editorContainer {
                position: relative;
            }

            #paperTabs {
                width: 100%;
                margin: 0 auto;
                font-size: calc(50px - 1vw);
                --paper-tabs-selection-bar-color: #2a9af2;
                --paper-tab-ink: grey;
                --paper-tab-content: {
                    font-family: Ubuntu;
                    padding: 25px;
                }
                height: auto;
            }

            paper-tab {
                color: grey;
            }

            paper-tab.iron-selected {
                border: 1px solid rgba(0, 0, 0, .2500);
                box-shadow: 0px 0px 3px grey;
                color: black;
            }

            #textEditor {
                --wysiwyg-font: Ubuntu;
                font-size: calc(40px - 1vw);
            }

            #codeEditor {
                font-size: calc(40px - 1vw);
            }

            .previewContainer {
                box-shadow: 0px 0px 3px grey;
                padding: 25px;
                margin-top: 25px;
            }

            .savingText {
                color: grey;
                position: absolute;
                right: 20px;
                bottom: 15px;
            }
        </style>

        <redux-store id="reduxStoreElement" root-reducer="[[rootReducer]]" action="[[action]]" on-statechange="stateChange" store-name="PRENDUS_QUESTION_ELEMENTS"></redux-store>

        <dom-if if="[[loaded]]">
            <template>
                <paper-tabs id="paperTabs" selected="[[selected]]" on-selected-changed="selectedChanged">
                    <paper-tab>Text</paper-tab>
                    <paper-tab>Code</paper-tab>
                </paper-tabs>

                <iron-pages id="ironPages" selected="[[selected]]">
                    <div class="editorContainer">
                        <wysiwyg-e id="textEditor" class="editor" value="[[_question.text]]" on-value-changed="textEditorChanged" allowed-tag-names="[[getAllowedTagNames()]]">
                            <prendus-radio-tool on-insert-radio="insertRadio"></prendus-radio-tool>
                            <prendus-check-tool on-insert-check="insertCheck"></prendus-check-tool>
                            <prendus-input-tool on-insert-input="insertInput"></prendus-input-tool>
                            <prendus-essay-tool on-insert-essay="insertEssay"></prendus-essay-tool>
                            <prendus-variable-tool on-insert-variable="insertVariable"></prendus-variable-tool>
                            <prendus-math-tool on-insert-math="insertMath"></prendus-math-tool>
                            <prendus-image-tool on-insert-image="insertImage"></prendus-image-tool>
                        </wysiwyg-e>
                        <div class="savingText">[[getSavingText(saving)]]</div>
                    </div>

                    <div class="editorContainer">
                        <juicy-ace-editor id="codeEditor" theme="ace/theme/chrome" mode="ace/mode/javascript" class="editor" value="[[_question.code]]" on-change="codeEditorChanged"></juicy-ace-editor>
                        <div class="savingText">[[getSavingText(saving)]]</div>
                    </div>
                </iron-pages>

                <div class="previewContainer">
                    <prendus-view-question question="[[_question]]"></prendus-view-question>
                </div>
            </template>
        </dom-if>

        <dom-if if="[[!loaded]]">
            <template>
                Loading...
            </template>
        </dom-if>
    </template>

    <script type="module" src="prendus-edit-question.ts"></script>
</dom-module>
