<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../redux-store-element/redux-store.html">
<link rel="import" href="prendus-view-question.html">
<link rel="import" href="text-editor-tools/prendus-variable-tool.html">
<link rel="import" href="text-editor-tools/prendus-fill-in-the-blank-tool.html">
<link rel="import" href="text-editor-tools/prendus-essay-tool.html">
<link rel="import" href="text-editor-tools/prendus-code-tool.html">
<link rel="import" href="text-editor-tools/prendus-multiple-choice-tool.html">
<link rel="import" href="text-editor-tools/prendus-multiple-select-tool.html">
<link rel="import" href="text-editor-tools/prendus-math-tool.html">
<link rel="import" href="text-editor-tools/prendus-image-tool.html">
<link rel="import" href="text-editor-tools/prendus-graph-tool.html">
<link rel="import" href="../../node_modules/juicy-ace-editor/juicy-ace-editor.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/wysiwyg-e/wysiwyg-e.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">

<dom-module id="prendus-edit-question">
    <template>
        <style>
            .editor {
                width: 100%;
                height: 50vh;
                box-shadow: 0px 0px 3px grey;
                margin: 0 auto;
            }

            .editorContainer {
                position: relative;
            }

            #paperTabs {
                width: 100%;
                margin: 0 auto;
                font-size: calc(50px - 1vw);
                --paper-tabs-selection-bar-color: #2a9af2;
                --paper-tab-ink: grey;
                --paper-tab-content: {
                    font-family: Ubuntu;
                    padding: 25px;
                }
                height: auto;
            }

            paper-tab {
                color: grey;
            }

            paper-tab.iron-selected {
                border: 1px solid rgba(0, 0, 0, .2500);
                box-shadow: 0px 0px 3px grey;
                color: black;
            }

            #textEditor {
                --wysiwyg-font: Ubuntu;
                font-size: calc(40px - 1vw);
            }

            #codeEditor {
                font-size: calc(40px - 1vw);
            }

            .previewContainer {
                box-shadow: 0px 0px 3px grey;
                padding: 25px;
                margin-top: 25px;
            }

            .savingText {
                color: grey;
                position: absolute;
                right: 20px;
                bottom: 15px;
            }

            .switchEditorToJavaScriptIcon {
                position: absolute;
                right: -5px;
                top: 40px;
                cursor: pointer;
                z-index: 1;
            }

            .switchEditorToAssessMLIcon {
                position: absolute;
                right: -5px;
                top: 0px;
                cursor: pointer;
                z-index: 1;
                background-color: grey;
                color: white;
            }
        </style>

        <redux-store id="reduxStoreElement" root-reducer="[[rootReducer]]" action="[[action]]" on-statechange="stateChange" store-name="PRENDUS_QUESTION_ELEMENTS"></redux-store>

        <dom-if if="[[loaded]]">
            <template>
                <iron-pages id="ironPages" selected="[[selected]]">
                    <div class="editorContainer">
                        <paper-button id="switchEditorToJavaScriptIcon" class="switchEditorToJavaScriptIcon" on-click="switchEditorClick">
                            <iron-icon icon="icons:tab"></iron-icon>
                        </paper-button>
                        <paper-tooltip for="switchEditorToJavaScriptIcon" offset="5">
                            <span>JavaScript</span>
                        </paper-tooltip>

                        <wysiwyg-e id="textEditor" class="editor" value="[[_question.text]]" on-value-changed="textEditorChanged" allowed-tag-names="[[getAllowedTagNames()]]">
                            <prendus-multiple-choice-tool id="prendus-multiple-choice-tool" on-insert-radio="insertRadio" user-radios="[[userRadiosFromCode]]" on-radio-correct-changed="radioCorrectChanged" on-radio-content-changed="radioContentChanged" on-question-stem-changed="questionStemChanged" question="[[_question]]"></prendus-multiple-choice-tool>
                            <prendus-multiple-select-tool id="prendus-multiple-select-tool" on-insert-check="insertCheck" user-checks="[[userChecksFromCode]]" on-check-correct-changed="checkCorrectChanged"></prendus-multiple-select-tool>
                            <prendus-fill-in-the-blank-tool id="prendus-fill-in-the-blank-tool" on-insert-input="insertInput"></prendus-fill-in-the-blank-tool>
                            <prendus-essay-tool id="prendus-essay-tool" on-insert-essay="insertEssay"></prendus-essay-tool>
                            <prendus-code-tool id="prendus-code-tool" on-insert-code="insertCode"></prendus-code-tool>
                            <prendus-variable-tool id="prendus-variable-tool" on-insert-variable="insertVariable"></prendus-variable-tool>
                            <prendus-math-tool id="prendus-math-tool" on-insert-math="insertMath"></prendus-math-tool>
                            <prendus-image-tool id="prendus-image-tool" on-insert-image="insertImage"></prendus-image-tool>
                            <prendus-graph-tool id="prendus-graph-tool" on-insert-graph="insertGraph"></prendus-graph-tool>
                        </wysiwyg-e>
                        <div class="savingText">[[getSavingText(saving)]]</div>
                    </div>

                    <div class="editorContainer">
                        <paper-button id="switchEditorToAssessMLIcon" class="switchEditorToAssessMLIcon" on-click="switchEditorClick">
                            <iron-icon icon="icons:tab"></iron-icon>
                        </paper-button>
                        <paper-tooltip for="switchEditorToAssessMLIcon" offset="5">
                            <span>AssessML</span>
                        </paper-tooltip>

                        <juicy-ace-editor id="codeEditor" theme="ace/theme/chrome" mode="ace/mode/javascript" class="editor" value="[[_question.code]]" on-change="codeEditorChanged"></juicy-ace-editor>
                        <div class="savingText">[[getSavingText(saving)]]</div>
                    </div>
                </iron-pages>

                <div class="previewContainer">
                    <prendus-view-question question="[[_question]]"></prendus-view-question>
                </div>
            </template>
        </dom-if>

        <dom-if if="[[!loaded]]">
            <template>
                Loading...
            </template>
        </dom-if>
    </template>

    <script type="module" src="prendus-edit-question.ts"></script>
</dom-module>
